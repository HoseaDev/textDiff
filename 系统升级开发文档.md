# TextDiff ç³»ç»Ÿå‡çº§å¼€å‘æ–‡æ¡£

## ä¸€ã€ç°çŠ¶åˆ†æä¸éœ€æ±‚è¯„ä¼°

### 1.1 å½“å‰ç³»ç»Ÿèƒ½åŠ›
- âœ… å•æ–‡æ¡£ç‰ˆæœ¬ç®¡ç†
- âœ… ç‰ˆæœ¬å¯¹æ¯”å’Œå·®å¼‚æ˜¾ç¤º
- âœ… è‡ªåŠ¨ä¿å­˜/æ‰‹åŠ¨ä¿å­˜
- âœ… ç‰ˆæœ¬æ¢å¤åŠŸèƒ½
- âœ… WebSocket å®æ—¶åä½œåŸºç¡€

### 1.2 å­˜åœ¨çš„é—®é¢˜
1. **å•æ–‡æ¡£é™åˆ¶**ï¼šåªèƒ½ç®¡ç†å•ç¯‡æ–‡ç« ï¼Œæ— æ³•å¤„ç†å¤šæ–‡æ¡£åœºæ™¯
2. **æ— ç”¨æˆ·ç³»ç»Ÿ**ï¼šç¼ºå°‘ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†
3. **æ•°æ®åº“é™åˆ¶**ï¼šä½¿ç”¨ SQLiteï¼Œä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ
4. **æ—¶åŒºé—®é¢˜**ï¼šæ—¶é—´æ˜¾ç¤ºé”™è¯¯ï¼ˆUTC vs æœ¬åœ°æ—¶é—´ï¼Œ8å°æ—¶åå·®ï¼‰
5. **ç¼ºå°‘æ–‡æ¡£ç»„ç»‡**ï¼šæ²¡æœ‰æ–‡ä»¶å¤¹/é¡¹ç›®/åˆ†ç±»ç®¡ç†
6. **æ— æƒé™æ§åˆ¶**ï¼šæ‰€æœ‰äººéƒ½èƒ½è®¿é—®æ‰€æœ‰æ–‡æ¡£

### 1.3 å‡çº§éœ€æ±‚
- ğŸ”´ **å¤šæ–‡æ¡£ç®¡ç†ç³»ç»Ÿ**
- ğŸ”´ **ç”¨æˆ·è®¤è¯ä¸æˆæƒ**
- ğŸ”´ **MySQL æ•°æ®åº“æ”¯æŒ**
- ğŸ”´ **ä¿®å¤æ—¶åŒºé—®é¢˜**
- ğŸŸ¡ æ–‡æ¡£åˆ†ç±»ä¸ç»„ç»‡
- ğŸŸ¡ åä½œä¸æƒé™ç®¡ç†
- ğŸŸ¡ æœç´¢åŠŸèƒ½

---

## äºŒã€ç³»ç»Ÿæ¶æ„å‡çº§æ–¹æ¡ˆ

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å‰ç«¯ (Vue 3 + TypeScript)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  è·¯ç”±å®ˆå« â†’ ç™»å½•é¡µ â†’ æ–‡æ¡£åˆ—è¡¨ â†’ æ–‡æ¡£ç¼–è¾‘å™¨      â”‚   â”‚
â”‚  â”‚  ç”¨æˆ·ç®¡ç† | æƒé™æ§åˆ¶ | å¤šæ–‡æ¡£åˆ‡æ¢ | æœç´¢       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“â†‘
                     [JWT Token è®¤è¯]
                            â†“â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                åç«¯ (FastAPI + SQLAlchemy)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  è®¤è¯ä¸­é—´ä»¶ â†’ ç”¨æˆ·æœåŠ¡ â†’ æ–‡æ¡£æœåŠ¡ â†’ ç‰ˆæœ¬æœåŠ¡    â”‚   â”‚
â”‚  â”‚  æƒé™æ£€æŸ¥ | å¤šç§Ÿæˆ· | æ–‡æ¡£ç´¢å¼• | å…¨æ–‡æœç´¢       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MySQL 8.0+ æ•°æ®åº“                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  users | documents | versions | permissions     â”‚   â”‚
â”‚  â”‚  folders | shares | audit_logs | sessions       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ•°æ®åº“è®¾è®¡ï¼ˆMySQLï¼‰

#### 2.2.1 ç”¨æˆ·ç›¸å…³è¡¨

```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id VARCHAR(36) PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    full_name VARCHAR(100),
    avatar_url VARCHAR(500),
    is_active BOOLEAN DEFAULT TRUE,
    is_superuser BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    last_login_at TIMESTAMP NULL,
    timezone VARCHAR(50) DEFAULT 'Asia/Shanghai',
    INDEX idx_email (email),
    INDEX idx_username (username)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- ç”¨æˆ·ä¼šè¯è¡¨
CREATE TABLE user_sessions (
    id VARCHAR(36) PRIMARY KEY,
    user_id VARCHAR(36) NOT NULL,
    token VARCHAR(500) NOT NULL,
    refresh_token VARCHAR(500),
    expires_at TIMESTAMP NOT NULL,
    ip_address VARCHAR(45),
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_token (token),
    INDEX idx_user_expires (user_id, expires_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 2.2.2 æ–‡æ¡£ç»„ç»‡è¡¨

```sql
-- æ–‡ä»¶å¤¹/é¡¹ç›®è¡¨
CREATE TABLE folders (
    id VARCHAR(36) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    parent_id VARCHAR(36),
    owner_id VARCHAR(36) NOT NULL,
    color VARCHAR(7),  -- HEX é¢œè‰²
    icon VARCHAR(50),   -- å›¾æ ‡å
    is_public BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (parent_id) REFERENCES folders(id) ON DELETE CASCADE,
    FOREIGN KEY (owner_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_owner (owner_id),
    INDEX idx_parent (parent_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- æ›´æ–°æ–‡æ¡£è¡¨
ALTER TABLE documents ADD COLUMN folder_id VARCHAR(36);
ALTER TABLE documents ADD COLUMN owner_id VARCHAR(36) NOT NULL;
ALTER TABLE documents ADD COLUMN is_public BOOLEAN DEFAULT FALSE;
ALTER TABLE documents ADD COLUMN view_count INT DEFAULT 0;
ALTER TABLE documents ADD COLUMN star_count INT DEFAULT 0;
ALTER TABLE documents ADD COLUMN last_accessed_at TIMESTAMP NULL;
ALTER TABLE documents ADD FOREIGN KEY (folder_id) REFERENCES folders(id) ON DELETE SET NULL;
ALTER TABLE documents ADD FOREIGN KEY (owner_id) REFERENCES users(id) ON DELETE CASCADE;
ALTER TABLE documents ADD INDEX idx_owner_folder (owner_id, folder_id);
ALTER TABLE documents ADD FULLTEXT INDEX ft_title_search (title);
```

#### 2.2.3 æƒé™ä¸åä½œè¡¨

```sql
-- æ–‡æ¡£æƒé™è¡¨
CREATE TABLE document_permissions (
    id VARCHAR(36) PRIMARY KEY,
    document_id VARCHAR(36) NOT NULL,
    user_id VARCHAR(36) NOT NULL,
    permission ENUM('view', 'edit', 'admin') NOT NULL,
    granted_by VARCHAR(36) NOT NULL,
    granted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP NULL,
    FOREIGN KEY (document_id) REFERENCES documents(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (granted_by) REFERENCES users(id),
    UNIQUE KEY unique_doc_user (document_id, user_id),
    INDEX idx_user_docs (user_id, permission)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- æ–‡æ¡£åˆ†äº«é“¾æ¥è¡¨
CREATE TABLE document_shares (
    id VARCHAR(36) PRIMARY KEY,
    document_id VARCHAR(36) NOT NULL,
    share_code VARCHAR(20) UNIQUE NOT NULL,
    created_by VARCHAR(36) NOT NULL,
    permission ENUM('view', 'edit') DEFAULT 'view',
    password VARCHAR(255),  -- å¯é€‰å¯†ç ä¿æŠ¤
    expires_at TIMESTAMP NULL,
    max_views INT,  -- æœ€å¤§è®¿é—®æ¬¡æ•°
    view_count INT DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (document_id) REFERENCES documents(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_share_code (share_code)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- æ”¶è—è¡¨
CREATE TABLE user_favorites (
    user_id VARCHAR(36) NOT NULL,
    document_id VARCHAR(36) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (user_id, document_id),
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (document_id) REFERENCES documents(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 2.2.4 å®¡è®¡æ—¥å¿—è¡¨

```sql
-- æ“ä½œæ—¥å¿—è¡¨
CREATE TABLE audit_logs (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id VARCHAR(36),
    document_id VARCHAR(36),
    action VARCHAR(50) NOT NULL,  -- create, update, delete, view, share
    details JSON,
    ip_address VARCHAR(45),
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_user_action (user_id, action),
    INDEX idx_document (document_id),
    INDEX idx_created (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 2.2.5 ä¿®å¤ç‰ˆæœ¬è¡¨æ—¶åŒº

```sql
-- æ›´æ–°ç‰ˆæœ¬è¡¨ï¼Œæ·»åŠ ç”¨æˆ·å…³è”
ALTER TABLE versions ADD COLUMN author_id VARCHAR(36);
ALTER TABLE versions ADD FOREIGN KEY (author_id) REFERENCES users(id) ON DELETE SET NULL;

-- ä¿®å¤æ—¶é—´å­—æ®µï¼Œä½¿ç”¨ MySQL çš„æ—¶åŒºæ”¯æŒ
ALTER TABLE versions MODIFY created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP;
ALTER TABLE documents MODIFY created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP;
ALTER TABLE documents MODIFY updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP;
```

---

## ä¸‰ã€åç«¯å®ç°æ–¹æ¡ˆ

### 3.1 ç”¨æˆ·è®¤è¯ç³»ç»Ÿ

#### 3.1.1 JWT è®¤è¯å®ç°

```python
# backend/app/core/auth.py
from datetime import datetime, timedelta
from typing import Optional
import jwt
from passlib.context import CryptContext
from fastapi import Depends, HTTPException, status
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")
security = HTTPBearer()

class AuthService:
    @staticmethod
    def hash_password(password: str) -> str:
        return pwd_context.hash(password)

    @staticmethod
    def verify_password(plain_password: str, hashed_password: str) -> bool:
        return pwd_context.verify(plain_password, hashed_password)

    @staticmethod
    def create_access_token(user_id: str, expires_delta: timedelta = timedelta(hours=24)):
        expire = datetime.utcnow() + expires_delta
        payload = {
            "sub": user_id,
            "exp": expire,
            "iat": datetime.utcnow()
        }
        return jwt.encode(payload, settings.SECRET_KEY, algorithm="HS256")

    @staticmethod
    def decode_token(token: str) -> dict:
        try:
            payload = jwt.decode(token, settings.SECRET_KEY, algorithms=["HS256"])
            return payload
        except jwt.ExpiredSignatureError:
            raise HTTPException(status_code=401, detail="Token expired")
        except jwt.JWTError:
            raise HTTPException(status_code=401, detail="Invalid token")

# ä¾èµ–æ³¨å…¥ï¼šè·å–å½“å‰ç”¨æˆ·
async def get_current_user(credentials: HTTPAuthorizationCredentials = Depends(security)):
    token = credentials.credentials
    payload = AuthService.decode_token(token)
    user_id = payload.get("sub")

    # ä»æ•°æ®åº“è·å–ç”¨æˆ·
    user = UserService.get_user(db, user_id)
    if not user:
        raise HTTPException(status_code=401, detail="User not found")

    return user
```

#### 3.1.2 ç”¨æˆ·æœåŠ¡

```python
# backend/app/services/user_service.py
from typing import Optional, List
from sqlalchemy.orm import Session
from ..models.user import User
from ..core.auth import AuthService

class UserService:
    @staticmethod
    def create_user(db: Session, username: str, email: str, password: str) -> User:
        # æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨
        if db.query(User).filter(
            (User.username == username) | (User.email == email)
        ).first():
            raise ValueError("User already exists")

        user = User(
            username=username,
            email=email,
            password_hash=AuthService.hash_password(password),
            timezone='Asia/Shanghai'  # é»˜è®¤ä¸­å›½æ—¶åŒº
        )
        db.add(user)
        db.commit()
        db.refresh(user)
        return user

    @staticmethod
    def authenticate(db: Session, username: str, password: str) -> Optional[User]:
        user = db.query(User).filter(
            (User.username == username) | (User.email == username)
        ).first()

        if user and AuthService.verify_password(password, user.password_hash):
            # æ›´æ–°æœ€åç™»å½•æ—¶é—´
            user.last_login_at = datetime.utcnow()
            db.commit()
            return user
        return None

    @staticmethod
    def get_user_documents(db: Session, user_id: str, folder_id: Optional[str] = None):
        query = db.query(Document).filter(Document.owner_id == user_id)

        if folder_id:
            query = query.filter(Document.folder_id == folder_id)

        return query.order_by(Document.updated_at.desc()).all()
```

### 3.2 å¤šæ–‡æ¡£ç®¡ç†

#### 3.2.1 æ–‡æ¡£åˆ—è¡¨ API

```python
# backend/app/api/routes/documents.py
from fastapi import Depends, Query
from typing import Optional

@router.get("/my-documents", response_model=List[DocumentListResponse])
async def get_my_documents(
    folder_id: Optional[str] = None,
    search: Optional[str] = None,
    sort_by: str = Query(default="updated_at", pattern="^(title|created_at|updated_at)$"),
    order: str = Query(default="desc", pattern="^(asc|desc)$"),
    skip: int = Query(default=0, ge=0),
    limit: int = Query(default=20, le=100),
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """è·å–å½“å‰ç”¨æˆ·çš„æ–‡æ¡£åˆ—è¡¨"""
    query = db.query(Document).filter(Document.owner_id == current_user.id)

    # æ–‡ä»¶å¤¹ç­›é€‰
    if folder_id:
        query = query.filter(Document.folder_id == folder_id)

    # æœç´¢
    if search:
        query = query.filter(Document.title.contains(search))

    # æ’åº
    order_column = getattr(Document, sort_by)
    if order == "desc":
        query = query.order_by(order_column.desc())
    else:
        query = query.order_by(order_column.asc())

    # åˆ†é¡µ
    total = query.count()
    documents = query.offset(skip).limit(limit).all()

    return {
        "items": documents,
        "total": total,
        "skip": skip,
        "limit": limit
    }

@router.get("/shared-with-me", response_model=List[DocumentListResponse])
async def get_shared_documents(
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """è·å–åˆ†äº«ç»™æˆ‘çš„æ–‡æ¡£"""
    shared_docs = db.query(Document).join(DocumentPermission).filter(
        DocumentPermission.user_id == current_user.id
    ).all()

    return shared_docs

@router.get("/recent", response_model=List[DocumentListResponse])
async def get_recent_documents(
    limit: int = Query(default=10, le=50),
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """è·å–æœ€è¿‘è®¿é—®çš„æ–‡æ¡£"""
    docs = db.query(Document).filter(
        Document.owner_id == current_user.id,
        Document.last_accessed_at.isnot(None)
    ).order_by(
        Document.last_accessed_at.desc()
    ).limit(limit).all()

    return docs
```

#### 3.2.2 æ–‡ä»¶å¤¹ç®¡ç†

```python
# backend/app/api/routes/folders.py
@router.post("/folders", response_model=FolderResponse)
async def create_folder(
    data: FolderCreate,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """åˆ›å»ºæ–‡ä»¶å¤¹"""
    folder = Folder(
        name=data.name,
        description=data.description,
        parent_id=data.parent_id,
        owner_id=current_user.id,
        color=data.color,
        icon=data.icon
    )
    db.add(folder)
    db.commit()
    db.refresh(folder)
    return folder

@router.get("/folders/tree", response_model=List[FolderTreeNode])
async def get_folder_tree(
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """è·å–æ–‡ä»¶å¤¹æ ‘å½¢ç»“æ„"""
    def build_tree(parent_id=None):
        folders = db.query(Folder).filter(
            Folder.owner_id == current_user.id,
            Folder.parent_id == parent_id
        ).all()

        tree = []
        for folder in folders:
            node = {
                "id": folder.id,
                "name": folder.name,
                "color": folder.color,
                "icon": folder.icon,
                "document_count": db.query(Document).filter(
                    Document.folder_id == folder.id
                ).count(),
                "children": build_tree(folder.id)
            }
            tree.append(node)

        return tree

    return build_tree()
```

### 3.3 æƒé™ç®¡ç†

```python
# backend/app/services/permission_service.py
class PermissionService:
    @staticmethod
    def check_document_permission(
        db: Session,
        user_id: str,
        document_id: str,
        required_permission: str = "view"
    ) -> bool:
        document = db.query(Document).filter(Document.id == document_id).first()

        if not document:
            return False

        # æ–‡æ¡£æ‰€æœ‰è€…æ‹¥æœ‰æ‰€æœ‰æƒé™
        if document.owner_id == user_id:
            return True

        # å…¬å¼€æ–‡æ¡£å…è®¸æŸ¥çœ‹
        if document.is_public and required_permission == "view":
            return True

        # æ£€æŸ¥æƒé™è¡¨
        permission = db.query(DocumentPermission).filter(
            DocumentPermission.document_id == document_id,
            DocumentPermission.user_id == user_id
        ).first()

        if not permission:
            return False

        # æ£€æŸ¥æƒé™çº§åˆ«
        permission_levels = {"view": 1, "edit": 2, "admin": 3}
        return permission_levels[permission.permission] >= permission_levels[required_permission]

    @staticmethod
    def share_document(
        db: Session,
        document_id: str,
        user_id: str,
        shared_with_user_id: str,
        permission: str = "view"
    ):
        # éªŒè¯æ“ä½œè€…æƒé™
        if not PermissionService.check_document_permission(
            db, user_id, document_id, "admin"
        ):
            raise PermissionError("No permission to share this document")

        # åˆ›å»ºæˆ–æ›´æ–°æƒé™
        doc_permission = db.query(DocumentPermission).filter(
            DocumentPermission.document_id == document_id,
            DocumentPermission.user_id == shared_with_user_id
        ).first()

        if doc_permission:
            doc_permission.permission = permission
            doc_permission.granted_by = user_id
            doc_permission.granted_at = datetime.utcnow()
        else:
            doc_permission = DocumentPermission(
                document_id=document_id,
                user_id=shared_with_user_id,
                permission=permission,
                granted_by=user_id
            )
            db.add(doc_permission)

        db.commit()
        return doc_permission
```

### 3.4 ä¿®å¤æ—¶åŒºé—®é¢˜

```python
# backend/app/core/config.py
from zoneinfo import ZoneInfo

class Settings(BaseSettings):
    # ... å…¶ä»–é…ç½®
    DEFAULT_TIMEZONE: str = "Asia/Shanghai"

    def get_local_time(self, utc_time: datetime) -> datetime:
        """å°† UTC æ—¶é—´è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´"""
        if utc_time.tzinfo is None:
            utc_time = utc_time.replace(tzinfo=ZoneInfo("UTC"))
        local_tz = ZoneInfo(self.DEFAULT_TIMEZONE)
        return utc_time.astimezone(local_tz)

# backend/app/schemas/document.py
from datetime import datetime
from zoneinfo import ZoneInfo

class VersionResponse(BaseModel):
    # ... å…¶ä»–å­—æ®µ
    created_at: datetime

    class Config:
        json_encoders = {
            datetime: lambda v: v.astimezone(ZoneInfo("Asia/Shanghai")).isoformat()
        }

# æˆ–è€…åœ¨ API å±‚é¢å¤„ç†
@router.get("/documents/{id}")
async def get_document(id: str, db: Session = Depends(get_db)):
    document = DocumentService.get_document(db, id)

    # è½¬æ¢æ—¶åŒº
    if document:
        document.created_at = settings.get_local_time(document.created_at)
        document.updated_at = settings.get_local_time(document.updated_at)

    return document
```

---

## å››ã€å‰ç«¯å®ç°æ–¹æ¡ˆ

### 4.1 è·¯ç”±ä¸æƒé™

```typescript
// frontend/src/router/index.ts
import { createRouter, createWebHistory } from 'vue-router'
import { useAuthStore } from '@/stores/auth'

const router = createRouter({
  history: createWebHistory(),
  routes: [
    {
      path: '/login',
      name: 'Login',
      component: () => import('@/views/LoginView.vue'),
      meta: { requiresAuth: false }
    },
    {
      path: '/register',
      name: 'Register',
      component: () => import('@/views/RegisterView.vue'),
      meta: { requiresAuth: false }
    },
    {
      path: '/',
      name: 'Dashboard',
      component: () => import('@/views/DashboardView.vue'),
      meta: { requiresAuth: true },
      children: [
        {
          path: 'documents',
          name: 'DocumentList',
          component: () => import('@/views/DocumentListView.vue')
        },
        {
          path: 'documents/:id',
          name: 'DocumentEdit',
          component: () => import('@/views/DocumentView.vue')
        },
        {
          path: 'folders/:folderId?',
          name: 'FolderView',
          component: () => import('@/views/FolderView.vue')
        },
        {
          path: 'shared',
          name: 'SharedDocuments',
          component: () => import('@/views/SharedView.vue')
        },
        {
          path: 'recent',
          name: 'RecentDocuments',
          component: () => import('@/views/RecentView.vue')
        }
      ]
    }
  ]
})

// è·¯ç”±å®ˆå«
router.beforeEach(async (to, from, next) => {
  const authStore = useAuthStore()

  // æ£€æŸ¥æ˜¯å¦éœ€è¦è®¤è¯
  if (to.meta.requiresAuth) {
    if (!authStore.isAuthenticated) {
      // å°è¯•ä» localStorage æ¢å¤ä¼šè¯
      await authStore.restoreSession()

      if (!authStore.isAuthenticated) {
        return next({ name: 'Login', query: { redirect: to.fullPath } })
      }
    }
  }

  next()
})

export default router
```

### 4.2 è®¤è¯ Store

```typescript
// frontend/src/stores/auth.ts
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import { authApi } from '@/api/auth'
import type { User, LoginRequest, RegisterRequest } from '@/types'

export const useAuthStore = defineStore('auth', () => {
  const user = ref<User | null>(null)
  const token = ref<string | null>(null)
  const isLoading = ref(false)

  const isAuthenticated = computed(() => !!token.value)

  async function login(credentials: LoginRequest) {
    isLoading.value = true
    try {
      const response = await authApi.login(credentials)
      token.value = response.access_token
      user.value = response.user

      // ä¿å­˜åˆ° localStorage
      localStorage.setItem('token', response.access_token)
      localStorage.setItem('user', JSON.stringify(response.user))

      // è®¾ç½® axios é»˜è®¤ header
      api.defaults.headers.common['Authorization'] = `Bearer ${response.access_token}`

      return response
    } finally {
      isLoading.value = false
    }
  }

  async function register(data: RegisterRequest) {
    isLoading.value = true
    try {
      const response = await authApi.register(data)
      // æ³¨å†ŒæˆåŠŸåè‡ªåŠ¨ç™»å½•
      await login({ username: data.username, password: data.password })
      return response
    } finally {
      isLoading.value = false
    }
  }

  function logout() {
    user.value = null
    token.value = null
    localStorage.removeItem('token')
    localStorage.removeItem('user')
    delete api.defaults.headers.common['Authorization']

    // è·³è½¬åˆ°ç™»å½•é¡µ
    router.push('/login')
  }

  async function restoreSession() {
    const savedToken = localStorage.getItem('token')
    const savedUser = localStorage.getItem('user')

    if (savedToken && savedUser) {
      try {
        // éªŒè¯ token æ˜¯å¦æœ‰æ•ˆ
        const response = await authApi.verifyToken(savedToken)
        if (response.valid) {
          token.value = savedToken
          user.value = JSON.parse(savedUser)
          api.defaults.headers.common['Authorization'] = `Bearer ${savedToken}`
          return true
        }
      } catch {
        // Token æ— æ•ˆï¼Œæ¸…ç†æœ¬åœ°å­˜å‚¨
        logout()
      }
    }
    return false
  }

  return {
    user,
    token,
    isLoading,
    isAuthenticated,
    login,
    register,
    logout,
    restoreSession
  }
})
```

### 4.3 æ–‡æ¡£åˆ—è¡¨ç•Œé¢

```vue
<!-- frontend/src/views/DocumentListView.vue -->
<template>
  <div class="document-list">
    <!-- é¡¶éƒ¨å·¥å…·æ  -->
    <div class="toolbar">
      <div class="left-section">
        <button @click="createDocument" class="btn btn-primary">
          <Icon name="plus" /> æ–°å»ºæ–‡æ¡£
        </button>

        <div class="view-toggle">
          <button
            :class="{ active: viewMode === 'grid' }"
            @click="viewMode = 'grid'"
          >
            <Icon name="grid" />
          </button>
          <button
            :class="{ active: viewMode === 'list' }"
            @click="viewMode = 'list'"
          >
            <Icon name="list" />
          </button>
        </div>
      </div>

      <div class="right-section">
        <!-- æœç´¢æ¡† -->
        <div class="search-box">
          <Icon name="search" />
          <input
            v-model="searchQuery"
            @input="debouncedSearch"
            placeholder="æœç´¢æ–‡æ¡£..."
          />
        </div>

        <!-- æ’åºé€‰é¡¹ -->
        <select v-model="sortBy" @change="loadDocuments" class="sort-select">
          <option value="updated_at">æœ€è¿‘ä¿®æ”¹</option>
          <option value="created_at">åˆ›å»ºæ—¶é—´</option>
          <option value="title">æ ‡é¢˜</option>
        </select>
      </div>
    </div>

    <!-- æ–‡ä»¶å¤¹è·¯å¾„å¯¼èˆª -->
    <div class="breadcrumb" v-if="currentFolder">
      <a @click="navigateToFolder(null)">æˆ‘çš„æ–‡æ¡£</a>
      <template v-for="folder in folderPath" :key="folder.id">
        <span class="separator">/</span>
        <a @click="navigateToFolder(folder.id)">{{ folder.name }}</a>
      </template>
    </div>

    <!-- æ–‡æ¡£ç½‘æ ¼/åˆ—è¡¨ -->
    <div v-if="viewMode === 'grid'" class="document-grid">
      <div
        v-for="doc in documents"
        :key="doc.id"
        class="document-card"
        @click="openDocument(doc.id)"
      >
        <div class="card-header">
          <Icon :name="doc.icon || 'document'" />
          <div class="card-menu">
            <button @click.stop="showDocumentMenu(doc, $event)">
              <Icon name="more" />
            </button>
          </div>
        </div>

        <div class="card-body">
          <h3>{{ doc.title }}</h3>
          <p class="preview">{{ doc.preview }}</p>
        </div>

        <div class="card-footer">
          <span class="date">{{ formatDate(doc.updated_at) }}</span>
          <div class="stats">
            <span v-if="doc.is_shared">
              <Icon name="share" />
            </span>
            <span>{{ doc.version_count }} ç‰ˆæœ¬</span>
          </div>
        </div>
      </div>
    </div>

    <div v-else class="document-table">
      <table>
        <thead>
          <tr>
            <th>æ ‡é¢˜</th>
            <th>æ–‡ä»¶å¤¹</th>
            <th>æœ€åä¿®æ”¹</th>
            <th>ç‰ˆæœ¬æ•°</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="doc in documents" :key="doc.id">
            <td>
              <a @click="openDocument(doc.id)">{{ doc.title }}</a>
            </td>
            <td>{{ doc.folder_name || '-' }}</td>
            <td>{{ formatDate(doc.updated_at) }}</td>
            <td>{{ doc.version_count }}</td>
            <td>
              <button @click="showDocumentMenu(doc, $event)">
                <Icon name="more" />
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- åˆ†é¡µ -->
    <div class="pagination" v-if="totalPages > 1">
      <button
        @click="currentPage--"
        :disabled="currentPage === 1"
      >
        ä¸Šä¸€é¡µ
      </button>
      <span>{{ currentPage }} / {{ totalPages }}</span>
      <button
        @click="currentPage++"
        :disabled="currentPage === totalPages"
      >
        ä¸‹ä¸€é¡µ
      </button>
    </div>

    <!-- å³é”®èœå• -->
    <ContextMenu
      v-if="showMenu"
      :x="menuX"
      :y="menuY"
      @close="showMenu = false"
    >
      <div @click="renameDocument">é‡å‘½å</div>
      <div @click="moveDocument">ç§»åŠ¨åˆ°...</div>
      <div @click="shareDocument">åˆ†äº«</div>
      <div @click="duplicateDocument">å¤åˆ¶</div>
      <hr />
      <div @click="deleteDocument" class="danger">åˆ é™¤</div>
    </ContextMenu>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, watch } from 'vue'
import { useRouter } from 'vue-router'
import { useDocumentStore } from '@/stores/document'
import { useAuthStore } from '@/stores/auth'
import { documentApi } from '@/api/client'
import { useDebounceFn } from '@vueuse/core'
import { formatDate } from '@/utils/date'

const router = useRouter()
const documentStore = useDocumentStore()
const authStore = useAuthStore()

const documents = ref([])
const viewMode = ref<'grid' | 'list'>('grid')
const searchQuery = ref('')
const sortBy = ref('updated_at')
const currentPage = ref(1)
const pageSize = 20
const totalCount = ref(0)
const currentFolder = ref(null)
const folderPath = ref([])

// å³é”®èœå•
const showMenu = ref(false)
const menuX = ref(0)
const menuY = ref(0)
const selectedDocument = ref(null)

const totalPages = computed(() => Math.ceil(totalCount.value / pageSize))

const debouncedSearch = useDebounceFn(() => {
  currentPage.value = 1
  loadDocuments()
}, 300)

async function loadDocuments() {
  try {
    const response = await documentApi.getMyDocuments({
      folder_id: currentFolder.value?.id,
      search: searchQuery.value,
      sort_by: sortBy.value,
      order: 'desc',
      skip: (currentPage.value - 1) * pageSize,
      limit: pageSize
    })

    documents.value = response.items
    totalCount.value = response.total
  } catch (error) {
    console.error('Failed to load documents:', error)
  }
}

async function createDocument() {
  const doc = await documentApi.create({
    title: 'æœªå‘½åæ–‡æ¡£',
    folder_id: currentFolder.value?.id,
    initial_content: ''
  })

  router.push(`/documents/${doc.id}`)
}

function openDocument(id: string) {
  router.push(`/documents/${id}`)
}

function showDocumentMenu(doc, event: MouseEvent) {
  event.preventDefault()
  selectedDocument.value = doc
  menuX.value = event.clientX
  menuY.value = event.clientY
  showMenu.value = true
}

async function deleteDocument() {
  if (confirm(`ç¡®å®šåˆ é™¤ "${selectedDocument.value.title}" å—ï¼Ÿ`)) {
    await documentApi.delete(selectedDocument.value.id)
    await loadDocuments()
  }
  showMenu.value = false
}

// ç›‘å¬åˆ†é¡µå˜åŒ–
watch(currentPage, loadDocuments)

onMounted(() => {
  loadDocuments()
})
</script>
```

---

## äº”ã€MySQL è¿ç§»æŒ‡å—

### 5.1 å®‰è£… MySQL é©±åŠ¨

```bash
# åç«¯ä¾èµ–
pip install pymysql
pip install mysqlclient  # æˆ–è€…ä½¿ç”¨ PyMySQL

# æ›´æ–° requirements.txt
echo "pymysql==1.1.0" >> requirements.txt
```

### 5.2 ä¿®æ”¹æ•°æ®åº“é…ç½®

```python
# backend/app/core/config.py
class Settings(BaseSettings):
    # MySQL è¿æ¥å­—ç¬¦ä¸²
    DATABASE_URL: str = "mysql+pymysql://username:password@localhost:3306/textdiff?charset=utf8mb4"

    # è¿æ¥æ± é…ç½®
    DATABASE_POOL_SIZE: int = 10
    DATABASE_POOL_RECYCLE: int = 3600
    DATABASE_POOL_PRE_PING: bool = True

# backend/app/core/database.py
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker

engine = create_engine(
    settings.DATABASE_URL,
    pool_size=settings.DATABASE_POOL_SIZE,
    pool_recycle=settings.DATABASE_POOL_RECYCLE,
    pool_pre_ping=settings.DATABASE_POOL_PRE_PING,
    echo=settings.DEBUG  # å¼€å‘ç¯å¢ƒæ‰“å° SQL
)
```

### 5.3 æ•°æ®è¿ç§»è„šæœ¬

```python
# backend/migrations/sqlite_to_mysql.py
import sqlite3
import pymysql
from datetime import datetime

def migrate_data():
    # è¿æ¥ SQLite
    sqlite_conn = sqlite3.connect('textdiff.db')
    sqlite_cursor = sqlite_conn.cursor()

    # è¿æ¥ MySQL
    mysql_conn = pymysql.connect(
        host='localhost',
        user='username',
        password='password',
        database='textdiff',
        charset='utf8mb4'
    )
    mysql_cursor = mysql_conn.cursor()

    # è¿ç§»æ–‡æ¡£è¡¨
    sqlite_cursor.execute("SELECT * FROM documents")
    documents = sqlite_cursor.fetchall()

    for doc in documents:
        mysql_cursor.execute("""
            INSERT INTO documents (id, title, created_at, updated_at, owner_id)
            VALUES (%s, %s, %s, %s, %s)
        """, (doc[0], doc[1], doc[2], doc[3], 'default_user_id'))

    # è¿ç§»ç‰ˆæœ¬è¡¨
    sqlite_cursor.execute("SELECT * FROM versions")
    versions = sqlite_cursor.fetchall()

    for ver in versions:
        mysql_cursor.execute("""
            INSERT INTO versions (
                id, document_id, version_number, content,
                content_hash, created_at, author, save_type
            )
            VALUES (%s, %s, %s, %s, %s, %s, %s, %s)
        """, ver)

    mysql_conn.commit()

    print(f"è¿ç§»å®Œæˆ: {len(documents)} ä¸ªæ–‡æ¡£, {len(versions)} ä¸ªç‰ˆæœ¬")

    sqlite_conn.close()
    mysql_conn.close()

if __name__ == "__main__":
    migrate_data()
```

---

## å…­ã€éƒ¨ç½²æ–¹æ¡ˆ

### 6.1 Docker éƒ¨ç½²

```dockerfile
# backend/Dockerfile
FROM python:3.11-slim

WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    gcc \
    default-libmysqlclient-dev \
    && rm -rf /var/lib/apt/lists/*

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: root_password
      MYSQL_DATABASE: textdiff
      MYSQL_USER: textdiff_user
      MYSQL_PASSWORD: textdiff_password
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./backend/migrations/init.sql:/docker-entrypoint-initdb.d/init.sql
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

  backend:
    build: ./backend
    environment:
      DATABASE_URL: mysql+pymysql://textdiff_user:textdiff_password@mysql:3306/textdiff?charset=utf8mb4
      SECRET_KEY: your-secret-key-here
      REDIS_URL: redis://redis:6379/0
    ports:
      - "8000:8000"
    depends_on:
      - mysql
      - redis
    volumes:
      - ./backend:/app

  frontend:
    build: ./frontend
    ports:
      - "80:80"
    depends_on:
      - backend

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

volumes:
  mysql_data:
  redis_data:
```

### 6.2 Nginx é…ç½®

```nginx
# nginx.conf
server {
    listen 80;
    server_name your-domain.com;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /usr/share/nginx/html;
        try_files $uri $uri/ /index.html;
    }

    # API ä»£ç†
    location /api {
        proxy_pass http://backend:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # WebSocket ä»£ç†
    location /ws {
        proxy_pass http://backend:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # å¼€å¯ Gzip
    gzip on;
    gzip_vary on;
    gzip_min_length 10240;
    gzip_proxied expired no-cache no-store private auth;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml;
}
```

---

## ä¸ƒã€ä¼˜åŒ–å»ºè®®

### 7.1 æ€§èƒ½ä¼˜åŒ–

1. **æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–**
   - ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
   - ä½¿ç”¨å¤åˆç´¢å¼•ä¼˜åŒ–å¤šæ¡ä»¶æŸ¥è¯¢
   - å®šæœŸåˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—

2. **ç¼“å­˜ç­–ç•¥**
   - Redis ç¼“å­˜çƒ­é—¨æ–‡æ¡£
   - ç¼“å­˜ diff ç»“æœ
   - ç”¨æˆ·ä¼šè¯ç¼“å­˜

3. **å‰ç«¯ä¼˜åŒ–**
   - è™šæ‹Ÿæ»šåŠ¨å¤„ç†å¤§åˆ—è¡¨
   - å›¾ç‰‡æ‡’åŠ è½½
   - ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½

### 7.2 å®‰å…¨åŠ å›º

1. **API å®‰å…¨**
   - Rate limiting
   - SQL æ³¨å…¥é˜²æŠ¤
   - XSS é˜²æŠ¤
   - CSRF ä¿æŠ¤

2. **æ•°æ®å®‰å…¨**
   - æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
   - HTTPS å¼ºåˆ¶
   - å®šæœŸå¤‡ä»½

3. **å®¡è®¡æ—¥å¿—**
   - è®°å½•æ‰€æœ‰å…³é”®æ“ä½œ
   - å¼‚å¸¸è¡Œä¸ºæ£€æµ‹

### 7.3 åŠŸèƒ½å¢å¼º

1. **åä½œåŠŸèƒ½**
   - å®æ—¶ååŒç¼–è¾‘
   - è¯„è®ºå’Œæ‰¹æ³¨
   - ç‰ˆæœ¬å¯¹æ¯”é€‰æ‹©

2. **å¯¼å‡ºåŠŸèƒ½**
   - PDF å¯¼å‡º
   - Word å¯¼å‡º
   - Markdown å¯¼å‡º

3. **é›†æˆåŠŸèƒ½**
   - Git é›†æˆ
   - ç¬¬ä¸‰æ–¹å­˜å‚¨æœåŠ¡
   - Webhook é€šçŸ¥

---

## å…«ã€å¼€å‘è®¡åˆ’

### Phase 1: åŸºç¡€åŠŸèƒ½ï¼ˆ2å‘¨ï¼‰
- [x] ç³»ç»Ÿæ¶æ„è®¾è®¡
- [x] MySQL æ•°æ®åº“æ­å»º
- [x] ç”¨æˆ·è®¤è¯ç³»ç»Ÿ (åç«¯âœ… å‰ç«¯âœ…)
- [ ] å¤šæ–‡æ¡£ç®¡ç†åŸºç¡€åŠŸèƒ½
- [x] æ—¶åŒºé—®é¢˜ä¿®å¤

### Phase 2: æ ¸å¿ƒåŠŸèƒ½ï¼ˆ2å‘¨ï¼‰
- [ ] æ–‡ä»¶å¤¹ç®¡ç†
- [ ] æƒé™ç³»ç»Ÿ
- [ ] æ–‡æ¡£åˆ†äº«åŠŸèƒ½
- [ ] æœç´¢åŠŸèƒ½
- [ ] å‰ç«¯ç•Œé¢ä¼˜åŒ–

### Phase 3: é«˜çº§åŠŸèƒ½ï¼ˆ2å‘¨ï¼‰
- [ ] å®æ—¶åä½œ
- [ ] å®¡è®¡æ—¥å¿—
- [ ] å¯¼å‡ºåŠŸèƒ½
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] éƒ¨ç½²è„šæœ¬

### Phase 4: æµ‹è¯•ä¸éƒ¨ç½²ï¼ˆ1å‘¨ï¼‰
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] å‹åŠ›æµ‹è¯•
- [ ] ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- [ ] ç›‘æ§é…ç½®

---

## ä¹ã€è¯¦ç»†å®ç°æ­¥éª¤

### 9.1 Phase 1: åŸºç¡€æ¶æ„å‡çº§ï¼ˆç¬¬1å‘¨ï¼‰

#### Step 1.1: MySQL æ•°æ®åº“è¿ç§»
**ä¼˜å…ˆçº§: ğŸ”´ å¿…é¡»**
**é¢„è®¡æ—¶é—´: 2å¤©**

1. **å®‰è£…å’Œé…ç½® MySQL**
   ```bash
   # macOS
   brew install mysql
   brew services start mysql

   # Ubuntu/Debian
   sudo apt update
   sudo apt install mysql-server
   sudo systemctl start mysql
   ```

2. **åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·**
   ```sql
   -- ç™»å½• MySQL
   mysql -u root -p

   -- åˆ›å»ºæ•°æ®åº“
   CREATE DATABASE textdiff CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

   -- åˆ›å»ºç”¨æˆ·
   CREATE USER 'textdiff_user'@'localhost' IDENTIFIED BY 'your_password';
   GRANT ALL PRIVILEGES ON textdiff.* TO 'textdiff_user'@'localhost';
   FLUSH PRIVILEGES;
   ```

3. **ä¿®æ”¹åç«¯æ•°æ®åº“é…ç½®**
   - æ›´æ–° `backend/requirements.txt` æ·»åŠ  MySQL é©±åŠ¨
   - ä¿®æ”¹ `backend/app/core/config.py` æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
   - ä¿®æ”¹ `backend/app/core/database.py` è¿æ¥æ± é…ç½®

4. **æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬**
   - åˆ›å»º `backend/migrations/001_init_mysql.sql`
   - è¿è¡Œæ‰€æœ‰å»ºè¡¨è¯­å¥
   - åˆ›å»ºç´¢å¼•å’Œå¤–é”®çº¦æŸ

#### Step 1.2: ä¿®å¤æ—¶åŒºé—®é¢˜
**ä¼˜å…ˆçº§: ğŸ”´ å¿…é¡»**
**é¢„è®¡æ—¶é—´: 0.5å¤©**

1. **åç«¯æ—¶åŒºé…ç½®**
   - åœ¨ `Settings` ç±»æ·»åŠ  `DEFAULT_TIMEZONE = "Asia/Shanghai"`
   - åˆ›å»ºæ—¶åŒºè½¬æ¢å·¥å…·å‡½æ•° `convert_to_local_time()`
   - ä¿®æ”¹æ‰€æœ‰ datetime å­—æ®µçš„åºåˆ—åŒ–æ–¹æ³•

2. **æ•°æ®åº“æ—¶åŒºè®¾ç½®**
   ```sql
   -- è®¾ç½® MySQL æ—¶åŒº
   SET GLOBAL time_zone = '+8:00';
   SET time_zone = '+8:00';
   ```

3. **å‰ç«¯æ—¶é—´æ˜¾ç¤º**
   - åˆ›å»º `frontend/src/utils/date.ts` æ—¶é—´æ ¼å¼åŒ–å·¥å…·
   - ä½¿ç”¨ `dayjs` æˆ– `date-fns` å¤„ç†æ—¶åŒº
   - ç»Ÿä¸€æ‰€æœ‰æ—¶é—´æ˜¾ç¤ºæ ¼å¼

4. **æµ‹è¯•éªŒè¯**
   - åˆ›å»ºæ–°ç‰ˆæœ¬ï¼Œæ£€æŸ¥æ—¶é—´æ˜¾ç¤º
   - éªŒè¯ä¸åŒæ—¶åŒºä¸‹çš„æ˜¾ç¤ºæ­£ç¡®æ€§

#### Step 1.3: ç”¨æˆ·è®¤è¯ç³»ç»Ÿ - åç«¯
**ä¼˜å…ˆçº§: ğŸ”´ å¿…é¡»**
**é¢„è®¡æ—¶é—´: 2å¤©**

1. **åˆ›å»ºç”¨æˆ·æ¨¡å‹**
   ```python
   # backend/app/models/user.py
   - User æ¨¡å‹ç±»
   - UserSession æ¨¡å‹ç±»
   - å¯†ç åŠ å¯†å­—æ®µ
   - æ—¶é—´æˆ³å­—æ®µ
   ```

2. **å®ç°è®¤è¯æœåŠ¡**
   ```python
   # backend/app/core/auth.py
   - hash_password() - å¯†ç å“ˆå¸Œ
   - verify_password() - å¯†ç éªŒè¯
   - create_access_token() - ç”Ÿæˆ JWT
   - decode_token() - è§£æ JWT
   - get_current_user() - ä¾èµ–æ³¨å…¥è·å–å½“å‰ç”¨æˆ·
   ```

3. **åˆ›å»ºç”¨æˆ· API ç«¯ç‚¹**
   ```python
   # backend/app/api/routes/auth.py
   - POST /api/auth/register - ç”¨æˆ·æ³¨å†Œ
   - POST /api/auth/login - ç”¨æˆ·ç™»å½•
   - POST /api/auth/logout - ç”¨æˆ·ç™»å‡º
   - GET /api/auth/me - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
   - POST /api/auth/refresh - åˆ·æ–° token
   ```

4. **æ·»åŠ è®¤è¯ä¸­é—´ä»¶**
   - æ‰€æœ‰ API ç«¯ç‚¹æ·»åŠ è®¤è¯æ£€æŸ¥
   - æ’é™¤å…¬å¼€ç«¯ç‚¹ï¼ˆç™»å½•ã€æ³¨å†Œï¼‰
   - å¤„ç† token è¿‡æœŸå’Œåˆ·æ–°

#### Step 1.4: ç”¨æˆ·è®¤è¯ç³»ç»Ÿ - å‰ç«¯
**ä¼˜å…ˆçº§: ğŸ”´ å¿…é¡»**
**é¢„è®¡æ—¶é—´: 1.5å¤©**

1. **åˆ›å»ºè®¤è¯ Store**
   ```typescript
   // frontend/src/stores/auth.ts
   - user çŠ¶æ€ç®¡ç†
   - token å­˜å‚¨å’Œç®¡ç†
   - login() æ–¹æ³•
   - logout() æ–¹æ³•
   - register() æ–¹æ³•
   - refreshToken() æ–¹æ³•
   ```

2. **åˆ›å»ºç™»å½•/æ³¨å†Œé¡µé¢**
   ```vue
   // frontend/src/views/LoginView.vue
   - ç™»å½•è¡¨å•
   - è¡¨å•éªŒè¯
   - é”™è¯¯å¤„ç†
   - è®°ä½å¯†ç åŠŸèƒ½

   // frontend/src/views/RegisterView.vue
   - æ³¨å†Œè¡¨å•
   - å¯†ç å¼ºåº¦æ£€æµ‹
   - é‚®ç®±éªŒè¯
   - ç”¨æˆ·åè®®
   ```

3. **é…ç½®è·¯ç”±å®ˆå«**
   ```typescript
   // frontend/src/router/index.ts
   - beforeEach å®ˆå«æ£€æŸ¥è®¤è¯
   - é‡å®šå‘æœªè®¤è¯ç”¨æˆ·åˆ°ç™»å½•é¡µ
   - ä¿å­˜åŸå§‹è®¿é—®è·¯å¾„
   - å¤„ç† token è‡ªåŠ¨åˆ·æ–°
   ```

4. **æ›´æ–° API å®¢æˆ·ç«¯**
   ```typescript
   // frontend/src/api/client.ts
   - æ·»åŠ  Authorization header
   - å¤„ç† 401 é”™è¯¯è‡ªåŠ¨åˆ·æ–° token
   - å¤„ç† token è¿‡æœŸé‡æ–°ç™»å½•
   ```

### 9.2 Phase 2: å¤šæ–‡æ¡£ç®¡ç†ï¼ˆç¬¬2-3å‘¨ï¼‰

#### Step 2.1: æ•°æ®åº“æ¨¡å‹æ‰©å±•
**ä¼˜å…ˆçº§: ğŸ”´ å¿…é¡»**
**é¢„è®¡æ—¶é—´: 1å¤©**

1. **æ–‡æ¡£æ‰€æœ‰æƒå…³è”**
   - ç»™ documents è¡¨æ·»åŠ  owner_id å­—æ®µ
   - åˆ›å»ºç”¨æˆ·-æ–‡æ¡£å…³è”ç´¢å¼•
   - è¿ç§»ç°æœ‰æ•°æ®åˆ°é»˜è®¤ç”¨æˆ·

2. **æ–‡ä»¶å¤¹/åˆ†ç±»ç³»ç»Ÿ**
   - åˆ›å»º folders è¡¨
   - æ”¯æŒåµŒå¥—æ–‡ä»¶å¤¹ï¼ˆparent_idï¼‰
   - æ–‡ä»¶å¤¹æƒé™ç»§æ‰¿

3. **æ–‡æ¡£å…ƒæ•°æ®æ‰©å±•**
   - æ·»åŠ  last_accessed_at å­—æ®µ
   - æ·»åŠ  view_count ç»Ÿè®¡
   - æ·»åŠ  is_public æ ‡è®°
   - æ·»åŠ æ–‡æ¡£æ ‡ç­¾ç³»ç»Ÿ

4. **æ•°æ®è¿ç§»è„šæœ¬**
   - å¤‡ä»½ç°æœ‰æ•°æ®
   - æ‰§è¡Œè¡¨ç»“æ„å˜æ›´
   - æ›´æ–°ç°æœ‰è®°å½•

#### Step 2.2: å¤šæ–‡æ¡£ API å®ç°
**ä¼˜å…ˆçº§: ğŸ”´ å¿…é¡»**
**é¢„è®¡æ—¶é—´: 2å¤©**

1. **æ–‡æ¡£åˆ—è¡¨ API**
   ```python
   # backend/app/api/routes/documents.py
   - GET /api/documents - è·å–ç”¨æˆ·æ‰€æœ‰æ–‡æ¡£
   - GET /api/documents/folder/{folder_id} - è·å–æ–‡ä»¶å¤¹å†…æ–‡æ¡£
   - GET /api/documents/recent - æœ€è¿‘è®¿é—®çš„æ–‡æ¡£
   - GET /api/documents/shared - åˆ†äº«ç»™æˆ‘çš„æ–‡æ¡£
   - GET /api/documents/public - å…¬å¼€æ–‡æ¡£
   ```

2. **æ–‡æ¡£æœç´¢ API**
   ```python
   - GET /api/documents/search?q=keyword - å…¨æ–‡æœç´¢
   - æ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€æ ‡ç­¾æœç´¢
   - æ”¯æŒé«˜çº§æœç´¢æ¡ä»¶ï¼ˆæ—¥æœŸèŒƒå›´ã€ä½œè€…ç­‰ï¼‰
   - æœç´¢ç»“æœé«˜äº®
   ```

3. **æ–‡ä»¶å¤¹ç®¡ç† API**
   ```python
   # backend/app/api/routes/folders.py
   - POST /api/folders - åˆ›å»ºæ–‡ä»¶å¤¹
   - PUT /api/folders/{id} - æ›´æ–°æ–‡ä»¶å¤¹
   - DELETE /api/folders/{id} - åˆ é™¤æ–‡ä»¶å¤¹
   - GET /api/folders/tree - è·å–æ–‡ä»¶å¤¹æ ‘
   - POST /api/folders/{id}/move - ç§»åŠ¨æ–‡æ¡£åˆ°æ–‡ä»¶å¤¹
   ```

4. **æ‰¹é‡æ“ä½œ API**
   ```python
   - POST /api/documents/batch/delete - æ‰¹é‡åˆ é™¤
   - POST /api/documents/batch/move - æ‰¹é‡ç§»åŠ¨
   - POST /api/documents/batch/export - æ‰¹é‡å¯¼å‡º
   ```

#### Step 2.3: å‰ç«¯æ–‡æ¡£ç®¡ç†ç•Œé¢
**ä¼˜å…ˆçº§: ğŸ”´ å¿…é¡»**
**é¢„è®¡æ—¶é—´: 3å¤©**

1. **æ–‡æ¡£åˆ—è¡¨é¡µé¢**
   ```vue
   // frontend/src/views/DocumentListView.vue
   - ç½‘æ ¼è§†å›¾å’Œåˆ—è¡¨è§†å›¾åˆ‡æ¢
   - æ–‡æ¡£å¡ç‰‡ç»„ä»¶
   - æ’åºé€‰é¡¹ï¼ˆåç§°ã€æ—¥æœŸã€å¤§å°ï¼‰
   - åˆ†é¡µç»„ä»¶
   - æ–‡æ¡£é¢„è§ˆ
   ```

2. **ä¾§è¾¹æ æ–‡ä»¶å¤¹æ ‘**
   ```vue
   // frontend/src/components/FolderTree.vue
   - é€’å½’æ ‘å½¢ç»„ä»¶
   - æ‹–æ‹½ç§»åŠ¨æ–‡æ¡£
   - å³é”®èœå•
   - æ–‡ä»¶å¤¹å±•å¼€/æŠ˜å çŠ¶æ€è®°å¿†
   ```

3. **æœç´¢åŠŸèƒ½**
   ```vue
   // frontend/src/components/SearchBar.vue
   - å®æ—¶æœç´¢å»ºè®®
   - æœç´¢å†å²
   - é«˜çº§æœç´¢é¢æ¿
   - æœç´¢ç»“æœå±•ç¤º
   ```

4. **æ–‡æ¡£æ“ä½œèœå•**
   ```vue
   // frontend/src/components/DocumentActions.vue
   - æ–°å»ºæ–‡æ¡£
   - å¯¼å…¥æ–‡æ¡£
   - æ‰¹é‡é€‰æ‹©
   - æ‰¹é‡æ“ä½œå·¥å…·æ 
   ```

#### Step 2.4: æ–‡æ¡£ç®¡ç† Store
**ä¼˜å…ˆçº§: ğŸ”´ å¿…é¡»**
**é¢„è®¡æ—¶é—´: 1å¤©**

1. **åˆ›å»ºæ–‡æ¡£åˆ—è¡¨ Store**
   ```typescript
   // frontend/src/stores/documentList.ts
   - documents æ•°ç»„çŠ¶æ€
   - folders æ ‘å½¢ç»“æ„
   - å½“å‰æ–‡ä»¶å¤¹
   - æœç´¢æ¡ä»¶
   - æ’åºæ–¹å¼
   ```

2. **å®ç° Store Actions**
   - loadDocuments() - åŠ è½½æ–‡æ¡£åˆ—è¡¨
   - createDocument() - åˆ›å»ºæ–°æ–‡æ¡£
   - deleteDocument() - åˆ é™¤æ–‡æ¡£
   - moveDocument() - ç§»åŠ¨æ–‡æ¡£
   - searchDocuments() - æœç´¢æ–‡æ¡£

3. **ç¼“å­˜ä¼˜åŒ–**
   - æ–‡æ¡£åˆ—è¡¨ç¼“å­˜
   - æœç´¢ç»“æœç¼“å­˜
   - ä¹è§‚æ›´æ–°

4. **çŠ¶æ€åŒæ­¥**
   - å¤šæ ‡ç­¾é¡µåŒæ­¥
   - WebSocket å®æ—¶æ›´æ–°

### 9.3 Phase 3: æƒé™ä¸åä½œï¼ˆç¬¬4å‘¨ï¼‰

#### Step 3.1: æƒé™ç³»ç»Ÿè®¾è®¡
**ä¼˜å…ˆçº§: ğŸŸ¡ é‡è¦**
**é¢„è®¡æ—¶é—´: 1å¤©**

1. **æƒé™çº§åˆ«å®šä¹‰**
   - owner - æ‰€æœ‰è€…ï¼Œæ‰€æœ‰æƒé™
   - admin - ç®¡ç†å‘˜ï¼Œå¯ä»¥åˆ†äº«å’Œåˆ é™¤
   - editor - ç¼–è¾‘è€…ï¼Œå¯ä»¥ä¿®æ”¹å†…å®¹
   - viewer - æŸ¥çœ‹è€…ï¼Œåªè¯»æƒé™

2. **æƒé™æ£€æŸ¥ä¸­é—´ä»¶**
   ```python
   # backend/app/middleware/permission.py
   - check_document_permission() - æ£€æŸ¥æ–‡æ¡£æƒé™
   - require_permission() - è£…é¥°å™¨
   - æƒé™ç»§æ‰¿è§„åˆ™
   ```

3. **æƒé™ç¼“å­˜**
   - Redis ç¼“å­˜ç”¨æˆ·æƒé™
   - æƒé™å˜æ›´æ—¶æ¸…é™¤ç¼“å­˜
   - å®šæœŸåˆ·æ–°ç­–ç•¥

4. **å®¡è®¡æ—¥å¿—**
   - è®°å½•æ‰€æœ‰æƒé™å˜æ›´
   - è®°å½•è®¿é—®æ—¥å¿—
   - å¼‚å¸¸æ“ä½œå‘Šè­¦

#### Step 3.2: æ–‡æ¡£åˆ†äº«åŠŸèƒ½
**ä¼˜å…ˆçº§: ğŸŸ¡ é‡è¦**
**é¢„è®¡æ—¶é—´: 2å¤©**

1. **åˆ†äº« API å®ç°**
   ```python
   # backend/app/api/routes/sharing.py
   - POST /api/documents/{id}/share - åˆ›å»ºåˆ†äº«
   - GET /api/shares/{code} - é€šè¿‡åˆ†äº«ç è®¿é—®
   - PUT /api/shares/{id} - æ›´æ–°åˆ†äº«è®¾ç½®
   - DELETE /api/shares/{id} - å–æ¶ˆåˆ†äº«
   ```

2. **åˆ†äº«é“¾æ¥ç”Ÿæˆ**
   - ç”Ÿæˆå”¯ä¸€åˆ†äº«ç 
   - æ”¯æŒå¯†ç ä¿æŠ¤
   - æ”¯æŒè¿‡æœŸæ—¶é—´
   - æ”¯æŒè®¿é—®æ¬¡æ•°é™åˆ¶

3. **æƒé™ç®¡ç†ç•Œé¢**
   ```vue
   // frontend/src/components/ShareDialog.vue
   - åˆ†äº«å¯¹è¯æ¡†
   - æƒé™çº§åˆ«é€‰æ‹©
   - ç”¨æˆ·æœç´¢å’Œæ·»åŠ 
   - åˆ†äº«é“¾æ¥ç”Ÿæˆå’Œå¤åˆ¶
   ```

4. **åä½œè€…åˆ—è¡¨**
   ```vue
   // frontend/src/components/CollaboratorList.vue
   - æ˜¾ç¤ºæ‰€æœ‰åä½œè€…
   - ä¿®æ”¹æƒé™çº§åˆ«
   - ç§»é™¤åä½œè€…
   - åœ¨çº¿çŠ¶æ€æ˜¾ç¤º
   ```

#### Step 3.3: å®æ—¶åä½œå¢å¼º
**ä¼˜å…ˆçº§: ğŸŸ¡ é‡è¦**
**é¢„è®¡æ—¶é—´: 2å¤©**

1. **WebSocket æ¶ˆæ¯æ‰©å±•**
   ```python
   # backend/app/services/websocket_manager.py
   - ç”¨æˆ·åŠ å…¥/ç¦»å¼€æˆ¿é—´
   - å…‰æ ‡ä½ç½®åŒæ­¥
   - é€‰åŒºåŒæ­¥
   - ç¼–è¾‘é”å®šæœºåˆ¶
   ```

2. **å†²çªè§£å†³æœºåˆ¶**
   - æ“ä½œè½¬æ¢ï¼ˆOTï¼‰ç®—æ³•
   - ç‰ˆæœ¬å‘é‡æ—¶é’Ÿ
   - è‡ªåŠ¨åˆå¹¶ç­–ç•¥
   - å†²çªæç¤º

3. **åä½œçŠ¶æ€æ˜¾ç¤º**
   ```vue
   // frontend/src/components/CollaborationStatus.vue
   - åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
   - ç”¨æˆ·å…‰æ ‡æ˜¾ç¤º
   - ç”¨æˆ·é€‰åŒºé«˜äº®
   - ç¼–è¾‘çŠ¶æ€æŒ‡ç¤ºå™¨
   ```

4. **åä½œé€šçŸ¥**
   - æ–°åä½œè€…åŠ å…¥é€šçŸ¥
   - æ–‡æ¡£è¢«ä¿®æ”¹é€šçŸ¥
   - æƒé™å˜æ›´é€šçŸ¥

### 9.4 Phase 4: æœç´¢ä¸ä¼˜åŒ–ï¼ˆç¬¬5å‘¨ï¼‰

#### Step 4.1: å…¨æ–‡æœç´¢å®ç°
**ä¼˜å…ˆçº§: ğŸŸ¡ é‡è¦**
**é¢„è®¡æ—¶é—´: 2å¤©**

1. **MySQL å…¨æ–‡ç´¢å¼•**
   ```sql
   -- åˆ›å»ºå…¨æ–‡ç´¢å¼•
   ALTER TABLE documents ADD FULLTEXT(title);
   ALTER TABLE versions ADD FULLTEXT(content);

   -- ä¸­æ–‡åˆ†è¯æ”¯æŒ
   SET GLOBAL innodb_ft_min_token_size = 2;
   ```

2. **æœç´¢æœåŠ¡å®ç°**
   ```python
   # backend/app/services/search_service.py
   - search_documents() - æ–‡æ¡£æœç´¢
   - search_in_versions() - ç‰ˆæœ¬å†…å®¹æœç´¢
   - build_search_query() - æ„å»ºæœç´¢æŸ¥è¯¢
   - highlight_results() - é«˜äº®æœç´¢ç»“æœ
   ```

3. **é«˜çº§æœç´¢åŠŸèƒ½**
   - æ”¯æŒå¸ƒå°”è¿ç®—ç¬¦ï¼ˆANDã€ORã€NOTï¼‰
   - æ”¯æŒé€šé…ç¬¦æœç´¢
   - æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼
   - æ”¯æŒèŒƒå›´æœç´¢ï¼ˆæ—¥æœŸã€å¤§å°ï¼‰

4. **æœç´¢ä¼˜åŒ–**
   - æœç´¢ç»“æœç¼“å­˜
   - æœç´¢å»ºè®®é¢„åŠ è½½
   - å¼‚æ­¥ç´¢å¼•æ›´æ–°
   - æœç´¢æ€§èƒ½ç›‘æ§

#### Step 4.2: æ€§èƒ½ä¼˜åŒ–
**ä¼˜å…ˆçº§: ğŸŸ¢ å¯é€‰**
**é¢„è®¡æ—¶é—´: 2å¤©**

1. **æ•°æ®åº“ä¼˜åŒ–**
   - æ·»åŠ å¿…è¦çš„ç´¢å¼•
   - ä¼˜åŒ–æŸ¥è¯¢è¯­å¥
   - é…ç½®è¿æ¥æ± 
   - å¼€å¯æŸ¥è¯¢ç¼“å­˜

2. **ç¼“å­˜ç­–ç•¥**
   ```python
   # backend/app/core/cache.py
   - Redis ç¼“å­˜é…ç½®
   - æ–‡æ¡£å†…å®¹ç¼“å­˜
   - diff ç»“æœç¼“å­˜
   - ç”¨æˆ·ä¼šè¯ç¼“å­˜
   ```

3. **å‰ç«¯ä¼˜åŒ–**
   - è™šæ‹Ÿæ»šåŠ¨å®ç°
   - å›¾ç‰‡æ‡’åŠ è½½
   - è·¯ç”±æ‡’åŠ è½½
   - èµ„æºé¢„åŠ è½½

4. **API ä¼˜åŒ–**
   - å“åº”å‹ç¼©
   - åˆ†é¡µä¼˜åŒ–
   - å¹¶å‘æ§åˆ¶
   - Rate limiting

#### Step 4.3: å¯¼å‡ºåŠŸèƒ½
**ä¼˜å…ˆçº§: ğŸŸ¢ å¯é€‰**
**é¢„è®¡æ—¶é—´: 1å¤©**

1. **å¯¼å‡º API**
   ```python
   # backend/app/api/routes/export.py
   - GET /api/documents/{id}/export/pdf - å¯¼å‡º PDF
   - GET /api/documents/{id}/export/word - å¯¼å‡º Word
   - GET /api/documents/{id}/export/markdown - å¯¼å‡º Markdown
   - GET /api/documents/{id}/export/html - å¯¼å‡º HTML
   ```

2. **æ‰¹é‡å¯¼å‡º**
   - æ”¯æŒå¤šæ–‡æ¡£æ‰“åŒ…
   - ZIP å‹ç¼©ä¸‹è½½
   - ä¿ç•™æ–‡ä»¶å¤¹ç»“æ„
   - åŒ…å«ç‰ˆæœ¬å†å²

3. **å¯¼å‡ºæ¨¡æ¿**
   - è‡ªå®šä¹‰é¡µçœ‰é¡µè„š
   - è‡ªå®šä¹‰æ ·å¼
   - æ°´å°æ”¯æŒ
   - ç›®å½•ç”Ÿæˆ

### 9.5 Phase 5: æµ‹è¯•ä¸éƒ¨ç½²ï¼ˆç¬¬6å‘¨ï¼‰

#### Step 5.1: å•å…ƒæµ‹è¯•
**ä¼˜å…ˆçº§: ğŸ”´ å¿…é¡»**
**é¢„è®¡æ—¶é—´: 2å¤©**

1. **åç«¯æµ‹è¯•**
   ```python
   # backend/tests/
   - ç”¨æˆ·è®¤è¯æµ‹è¯•
   - æ–‡æ¡£ CRUD æµ‹è¯•
   - æƒé™ç³»ç»Ÿæµ‹è¯•
   - diff ç®—æ³•æµ‹è¯•
   ```

2. **å‰ç«¯æµ‹è¯•**
   ```typescript
   // frontend/tests/
   - ç»„ä»¶å•å…ƒæµ‹è¯•
   - Store æµ‹è¯•
   - è·¯ç”±æµ‹è¯•
   - API è°ƒç”¨æµ‹è¯•
   ```

3. **é›†æˆæµ‹è¯•**
   - API ç«¯åˆ°ç«¯æµ‹è¯•
   - ç”¨æˆ·æµç¨‹æµ‹è¯•
   - æ€§èƒ½æµ‹è¯•
   - å®‰å…¨æµ‹è¯•

#### Step 5.2: éƒ¨ç½²å‡†å¤‡
**ä¼˜å…ˆçº§: ğŸ”´ å¿…é¡»**
**é¢„è®¡æ—¶é—´: 2å¤©**

1. **Docker å®¹å™¨åŒ–**
   - ç¼–å†™ Dockerfile
   - é…ç½® docker-compose
   - ç¯å¢ƒå˜é‡é…ç½®
   - å¥åº·æ£€æŸ¥é…ç½®

2. **CI/CD é…ç½®**
   - GitHub Actions é…ç½®
   - è‡ªåŠ¨åŒ–æµ‹è¯•
   - è‡ªåŠ¨åŒ–æ„å»º
   - è‡ªåŠ¨åŒ–éƒ¨ç½²

3. **ç›‘æ§é…ç½®**
   - æ—¥å¿—æ”¶é›†
   - æ€§èƒ½ç›‘æ§
   - é”™è¯¯è¿½è¸ª
   - å‘Šè­¦é…ç½®

4. **å¤‡ä»½ç­–ç•¥**
   - æ•°æ®åº“å®šæœŸå¤‡ä»½
   - å¢é‡å¤‡ä»½
   - å¼‚åœ°å¤‡ä»½
   - æ¢å¤æµ‹è¯•

## åã€å¼€å‘è¿›åº¦ç”˜ç‰¹å›¾

```
Week 1: åŸºç¡€æ¶æ„
â”œâ”€ Day 1-2: MySQL è¿ç§» â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”œâ”€ Day 2.5: æ—¶åŒºä¿®å¤ â–ˆâ–ˆ
â”œâ”€ Day 3-4: ç”¨æˆ·è®¤è¯åç«¯ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â””â”€ Day 4.5-5: ç”¨æˆ·è®¤è¯å‰ç«¯ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

Week 2-3: å¤šæ–‡æ¡£ç®¡ç†
â”œâ”€ Day 1: æ•°æ®åº“æ¨¡å‹ â–ˆâ–ˆâ–ˆâ–ˆ
â”œâ”€ Day 2-3: å¤šæ–‡æ¡£ API â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”œâ”€ Day 4-6: å‰ç«¯ç•Œé¢ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â””â”€ Day 7: Store å®ç° â–ˆâ–ˆâ–ˆâ–ˆ

Week 4: æƒé™ä¸åä½œ
â”œâ”€ Day 1: æƒé™ç³»ç»Ÿ â–ˆâ–ˆâ–ˆâ–ˆ
â”œâ”€ Day 2-3: åˆ†äº«åŠŸèƒ½ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â””â”€ Day 4-5: å®æ—¶åä½œ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

Week 5: æœç´¢ä¸ä¼˜åŒ–
â”œâ”€ Day 1-2: å…¨æ–‡æœç´¢ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”œâ”€ Day 3-4: æ€§èƒ½ä¼˜åŒ– â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â””â”€ Day 5: å¯¼å‡ºåŠŸèƒ½ â–ˆâ–ˆâ–ˆâ–ˆ

Week 6: æµ‹è¯•ä¸éƒ¨ç½²
â”œâ”€ Day 1-2: æµ‹è¯•ç¼–å†™ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”œâ”€ Day 3-4: éƒ¨ç½²å‡†å¤‡ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â””â”€ Day 5: ä¸Šçº¿å‘å¸ƒ â–ˆâ–ˆâ–ˆâ–ˆ
```

## åä¸€ã€é£é™©è¯„ä¼°ä¸åº”å¯¹

### 11.1 æŠ€æœ¯é£é™©

| é£é™©é¡¹ | å¯èƒ½æ€§ | å½±å“ | åº”å¯¹ç­–ç•¥ |
|-------|--------|------|---------|
| MySQL è¿ç§»æ•°æ®ä¸¢å¤± | ä½ | é«˜ | å®Œæ•´å¤‡ä»½ï¼Œåˆ†æ­¥è¿ç§»ï¼Œå›æ»šæ–¹æ¡ˆ |
| è®¤è¯ç³»ç»Ÿå®‰å…¨æ¼æ´ | ä¸­ | é«˜ | ä½¿ç”¨æˆç†Ÿæ¡†æ¶ï¼Œå®‰å…¨å®¡è®¡ï¼Œæ¸—é€æµ‹è¯• |
| å®æ—¶åä½œå†²çª | é«˜ | ä¸­ | OT ç®—æ³•ï¼Œç‰ˆæœ¬é”ï¼Œå†²çªæç¤º |
| æ€§èƒ½ç“¶é¢ˆ | ä¸­ | ä¸­ | ç¼“å­˜ç­–ç•¥ï¼Œæ•°æ®åº“ä¼˜åŒ–ï¼ŒCDN |
| ç¬¬ä¸‰æ–¹ä¾èµ–é—®é¢˜ | ä½ | ä½ | ç‰ˆæœ¬é”å®šï¼Œæ›¿ä»£æ–¹æ¡ˆ |

### 11.2 è¿›åº¦é£é™©

| é£é™©é¡¹ | åº”å¯¹ç­–ç•¥ |
|-------|---------|
| éœ€æ±‚å˜æ›´ | æ•æ·å¼€å‘ï¼Œå¿«é€Ÿè¿­ä»£ |
| æŠ€æœ¯éš¾ç‚¹ | é¢„ç ”å…³é”®æŠ€æœ¯ï¼Œå‡†å¤‡å¤‡é€‰æ–¹æ¡ˆ |
| äººå‘˜ä¸è¶³ | ä¼˜å…ˆçº§æ’åºï¼Œåˆ†é˜¶æ®µäº¤ä»˜ |
| æµ‹è¯•æ—¶é—´ä¸è¶³ | è‡ªåŠ¨åŒ–æµ‹è¯•ï¼ŒæŒç»­é›†æˆ |

## åäºŒã€éªŒæ”¶æ ‡å‡†

### 12.1 åŠŸèƒ½éªŒæ”¶

- [ ] ç”¨æˆ·å¯ä»¥æ³¨å†Œã€ç™»å½•ã€ç™»å‡º
- [ ] ç”¨æˆ·å¯ä»¥åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤è‡ªå·±çš„æ–‡æ¡£
- [ ] ç”¨æˆ·å¯ä»¥æŸ¥çœ‹æ–‡æ¡£ç‰ˆæœ¬å†å²
- [ ] ç”¨æˆ·å¯ä»¥å¯¹æ¯”ä¸åŒç‰ˆæœ¬å·®å¼‚
- [ ] ç”¨æˆ·å¯ä»¥ç»„ç»‡æ–‡æ¡£åˆ°æ–‡ä»¶å¤¹
- [ ] ç”¨æˆ·å¯ä»¥æœç´¢æ–‡æ¡£
- [ ] ç”¨æˆ·å¯ä»¥åˆ†äº«æ–‡æ¡£ç»™å…¶ä»–ç”¨æˆ·
- [ ] æ—¶é—´æ˜¾ç¤ºæ­£ç¡®ï¼ˆæ—  8 å°æ—¶åå·®ï¼‰
- [ ] æ”¯æŒå¤šäººåŒæ—¶åœ¨çº¿ç¼–è¾‘

### 12.2 æ€§èƒ½éªŒæ”¶

- [ ] é¡µé¢åŠ è½½æ—¶é—´ < 2ç§’
- [ ] API å“åº”æ—¶é—´ < 500ms
- [ ] æ”¯æŒ 1000+ æ–‡æ¡£åˆ—è¡¨å±•ç¤º
- [ ] æ”¯æŒ 10MB æ–‡æ¡£å†…å®¹
- [ ] æ”¯æŒ 100+ å¹¶å‘ç”¨æˆ·

### 12.3 å®‰å…¨éªŒæ”¶

- [ ] å¯†ç åŠ å¯†å­˜å‚¨
- [ ] JWT Token è®¤è¯
- [ ] SQL æ³¨å…¥é˜²æŠ¤
- [ ] XSS é˜²æŠ¤
- [ ] CSRF é˜²æŠ¤
- [ ] æƒé™æ§åˆ¶æ­£å¸¸

## åä¸‰ã€æ€»ç»“

æœ¬å‡çº§æ–¹æ¡ˆå°† TextDiff ä»å•ç”¨æˆ·å•æ–‡æ¡£ç³»ç»Ÿå‡çº§ä¸ºï¼š
- **å¤šç”¨æˆ·å¤šæ–‡æ¡£ç®¡ç†å¹³å°**
- **å®Œæ•´çš„æƒé™å’Œåä½œç³»ç»Ÿ**
- **ç”Ÿäº§çº§ MySQL æ•°æ®åº“**
- **ä¿®å¤æ—¶åŒºå’Œå…¶ä»–å·²çŸ¥é—®é¢˜**

æ ¸å¿ƒæ”¹è¿›ï¼š
1. ç”¨æˆ·è®¤è¯ä¸æˆæƒ
2. å¤šæ–‡æ¡£ç»„ç»‡ç®¡ç†
3. MySQL æ•°æ®åº“æ”¯æŒ
4. æ—¶åŒºé—®é¢˜ä¿®å¤
5. åä½œä¸åˆ†äº«åŠŸèƒ½

é¢„è®¡å¼€å‘å‘¨æœŸï¼š7å‘¨
é¢„è®¡å·¥ä½œé‡ï¼š2-3äººå›¢é˜Ÿ

åç»­å¯æ‰©å±•æ–¹å‘ï¼š
- ä¼ä¸šç‰ˆå¤šç§Ÿæˆ·
- AI è¾…åŠ©å†™ä½œ
- ç‰ˆæœ¬æ§åˆ¶é›†æˆ
- æ›´å¤šæ–‡ä»¶æ ¼å¼æ”¯æŒ
---

## åå››ã€å¼€å‘è¿›åº¦æ—¥å¿—

### 2025-10-21

#### âœ… å·²å®Œæˆ

**1. MySQL æ•°æ®åº“æ­å»º (Step 1.1)**
- åˆ›å»º `.env.mysql` é…ç½®æ–‡ä»¶
- åˆ›å»º `001_init_mysql.sql` åˆå§‹åŒ–è„šæœ¬(13å¼ è¡¨)
- åˆ›å»º `00_admin_setup.sql` ç®¡ç†å‘˜è®¾ç½®è„šæœ¬
- åˆ›å»º `init_database.py` å’Œ `verify_database.py` å·¥å…·è„šæœ¬
- æ•°æ®åº“å·²æˆåŠŸåˆ›å»º,åŒ…å«ä»¥ä¸‹è¡¨:
  - users (ç”¨æˆ·è¡¨)
  - user_sessions (ç”¨æˆ·ä¼šè¯è¡¨)
  - folders (æ–‡ä»¶å¤¹è¡¨)
  - documents (æ–‡æ¡£è¡¨)
  - versions (ç‰ˆæœ¬è¡¨)
  - version_tags (ç‰ˆæœ¬æ ‡ç­¾è¡¨)
  - document_permissions (æ–‡æ¡£æƒé™è¡¨)
  - document_shares (æ–‡æ¡£åˆ†äº«è¡¨)
  - user_favorites (ç”¨æˆ·æ”¶è—è¡¨)
  - audit_logs (å®¡è®¡æ—¥å¿—è¡¨)
- åˆ›å»ºé»˜è®¤ç®¡ç†å‘˜è´¦å·: admin/admin123

**2. æ—¶åŒºé—®é¢˜ä¿®å¤ (Step 1.2)**

åç«¯ä¿®æ”¹:
- æ›´æ–° `backend/app/core/config.py`
  - æ·»åŠ  `DEFAULT_TIMEZONE = "Asia/Shanghai"`
  - æ·»åŠ  `get_local_time()` å’Œ `get_utc_time()` æ–¹æ³•
- æ›´æ–° `backend/app/core/database.py`
  - é…ç½® MySQL è¿æ¥æ± 
- åˆ›å»º `backend/app/utils/timezone.py`
  - æ—¶åŒºè½¬æ¢å·¥å…·å‡½æ•°
- æ›´æ–° `backend/app/schemas/document.py`
  - æ·»åŠ  `@field_serializer` è£…é¥°å™¨è‡ªåŠ¨è½¬æ¢æ—¶åŒº

å‰ç«¯ä¿®æ”¹:
- åˆ›å»º `frontend/src/utils/date.ts`
  - `formatDate()` - æ ¼å¼åŒ–æ—¥æœŸ
  - `formatRelativeTime()` - ç›¸å¯¹æ—¶é—´
  - `formatFriendly()` - å‹å¥½æ˜¾ç¤º
  - `parseDate()` - è§£ææ—¥æœŸ
  - `isToday()`, `isYesterday()` - æ—¥æœŸåˆ¤æ–­

**3. ç”¨æˆ·è®¤è¯ç³»ç»Ÿ - åç«¯ (Step 1.3 - âœ… å·²å®Œæˆ)**

æ•°æ®æ¨¡å‹:
- åˆ›å»º `backend/app/models/user.py`
  - User æ¨¡å‹ç±»
  - UserSession æ¨¡å‹ç±»
  - Folder æ¨¡å‹ç±»

æ ¸å¿ƒæœåŠ¡:
- åˆ›å»º `backend/app/core/auth.py` - JWTè®¤è¯æœåŠ¡
  - `AuthService` ç±»:å¯†ç å“ˆå¸Œã€Tokenç”Ÿæˆ/è§£æ
  - ä¾èµ–æ³¨å…¥:è·å–å½“å‰ç”¨æˆ·ã€æ´»è·ƒç”¨æˆ·ã€è¶…çº§ç”¨æˆ·
  - æ”¯æŒè®¿é—®ä»¤ç‰Œ(24å°æ—¶)å’Œåˆ·æ–°ä»¤ç‰Œ(7å¤©)

æ•°æ®æ¨¡å‹:
- åˆ›å»º `backend/app/schemas/user.py` - ç”¨æˆ·æ•°æ®æ¨¡å‹
  - `UserCreate`, `UserLogin`, `UserUpdate`, `UserPasswordUpdate`
  - `UserResponse`, `TokenResponse`, `UserStats`
  - æ‰€æœ‰datetimeå­—æ®µè‡ªåŠ¨è½¬æ¢æ—¶åŒº

ä¸šåŠ¡é€»è¾‘:
- åˆ›å»º `backend/app/services/user_service.py` - ç”¨æˆ·æœåŠ¡
  - ç”¨æˆ·CRUDæ“ä½œ
  - è®¤è¯å’Œä¼šè¯ç®¡ç†
  - ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯

APIè·¯ç”±:
- åˆ›å»º `backend/app/api/routes/auth.py` - 11ä¸ªè®¤è¯ç«¯ç‚¹
  - POST `/api/auth/register` - æ³¨å†Œ
  - POST `/api/auth/login` - ç™»å½•
  - POST `/api/auth/logout` - ç™»å‡º
  - POST `/api/auth/refresh` - åˆ·æ–°Token
  - GET/PUT `/api/auth/me` - å½“å‰ç”¨æˆ·ä¿¡æ¯
  - POST `/api/auth/me/password` - ä¿®æ”¹å¯†ç 
  - GET `/api/auth/me/stats` - ç”¨æˆ·ç»Ÿè®¡
  - GET/DELETE `/api/auth/users/*` - ç®¡ç†å‘˜æ¥å£

ä¸»ç¨‹åº:
- æ›´æ–° `backend/app/main.py` - æ³¨å†Œauthè·¯ç”±

ä¾èµ–åŒ…:
- æ›´æ–° `backend/requirements.txt` å’Œ `.env`
  - pymysql==1.1.2, cryptography==46.0.3
  - python-jose==3.5.0, passlib==1.7.4, bcrypt==5.0.0
  - email-validator==2.3.0

æµ‹è¯•ç»“æœ:
- âœ… æ‰€æœ‰æ¨¡å—å¯¼å…¥æˆåŠŸ
- âœ… 11ä¸ªè®¤è¯ç«¯ç‚¹å…¨éƒ¨æ³¨å†Œ
- âœ… FastAPIåº”ç”¨åˆå§‹åŒ–æ­£å¸¸

**4. ç”¨æˆ·è®¤è¯ç³»ç»Ÿ - å‰ç«¯ (Step 1.4 - âœ… å·²å®Œæˆ)**

è®¤è¯Store:
- åˆ›å»º `frontend/src/stores/auth.ts` - Piniaè®¤è¯çŠ¶æ€ç®¡ç†
  - ç”¨æˆ·çŠ¶æ€ã€Tokenç®¡ç†
  - register(), login(), logout() æ–¹æ³•
  - restoreSession() - è‡ªåŠ¨æ¢å¤ç™»å½•ä¼šè¯
  - refreshAccessToken() - è‡ªåŠ¨åˆ·æ–°Token
  - updateProfile(), updatePassword() - ç”¨æˆ·ç®¡ç†

APIå®¢æˆ·ç«¯:
- æ›´æ–° `frontend/src/api/client.ts`
  - è¯·æ±‚æ‹¦æˆªå™¨:è‡ªåŠ¨æ·»åŠ Authorization header
  - å“åº”æ‹¦æˆªå™¨:401è‡ªåŠ¨åˆ·æ–°Tokené‡è¯•
  - Tokenè¿‡æœŸè‡ªåŠ¨è·³è½¬ç™»å½•é¡µ

é¡µé¢ç»„ä»¶:
- åˆ›å»º `frontend/src/views/LoginView.vue` - ç™»å½•é¡µé¢
  - ç”¨æˆ·å/é‚®ç®±ç™»å½•
  - è®°ä½æˆ‘é€‰é¡¹
  - é”™è¯¯æç¤º
  - ç¾è§‚çš„æ¸å˜UIè®¾è®¡

- åˆ›å»º `frontend/src/views/RegisterView.vue` - æ³¨å†Œé¡µé¢
  - ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç æ³¨å†Œ
  - å¯†ç å¼ºåº¦æŒ‡ç¤ºå™¨
  - å¯†ç ç¡®è®¤éªŒè¯
  - è¡¨å•å®æ—¶éªŒè¯

è·¯ç”±é…ç½®:
- æ›´æ–° `frontend/src/router/index.ts`
  - æ·»åŠ /loginå’Œ/registerè·¯ç”±
  - beforeEachè·¯ç”±å®ˆå«:è‡ªåŠ¨æ£€æŸ¥è®¤è¯çŠ¶æ€
  - æœªç™»å½•ç”¨æˆ·é‡å®šå‘åˆ°ç™»å½•é¡µ
  - å·²ç™»å½•ç”¨æˆ·è®¿é—®ç™»å½•é¡µé‡å®šå‘åˆ°é¦–é¡µ
  - ä¿å­˜å¹¶æ¢å¤åŸå§‹è®¿é—®è·¯å¾„

æµ‹è¯•åŠŸèƒ½:
- âœ… ç”¨æˆ·æ³¨å†Œæµç¨‹
- âœ… ç”¨æˆ·ç™»å½•æµç¨‹
- âœ… Tokenè‡ªåŠ¨åˆ·æ–°
- âœ… ä¼šè¯è‡ªåŠ¨æ¢å¤
- âœ… è·¯ç”±æƒé™æ§åˆ¶

#### â³ å¾…å¼€å§‹

**å¤šæ–‡æ¡£ç®¡ç†åŸºç¡€åŠŸèƒ½**
- æ–‡æ¡£åˆ—è¡¨API
- æ–‡ä»¶å¤¹ç®¡ç†
- æ–‡æ¡£æœç´¢

#### ğŸ“ æŠ€æœ¯è¦ç‚¹

1. **æ•°æ®åº“è¿æ¥**: PyMySQLé©±åŠ¨, è¿æ¥æ± é…ç½®, utf8mb4å­—ç¬¦é›†
2. **æ—¶åŒºå¤„ç†**: UTCå­˜å‚¨, Asia/Shanghaiæ˜¾ç¤º, Pydanticè‡ªåŠ¨è½¬æ¢
3. **å¯†ç å®‰å…¨**: bcryptç®—æ³•, passlibåº“
4. **JWT Token**: python-joseåº“, 24å°æ—¶è¿‡æœŸ

#### ğŸ› å·²ä¿®å¤é—®é¢˜

1. SQLè¯­æ³•é”™è¯¯: MySQL CREATE DATABASEä¸æ”¯æŒCOMMENT - å·²ç§»é™¤
2. æ•°æ®åº“æœªé€‰æ‹©: æ·»åŠ  USE textdiff;
3. æƒé™ä¸è¶³: ç®¡ç†å‘˜æˆæƒ

#### ğŸ“Š æ•°æ®åº“çŠ¶æ€

- æœåŠ¡å™¨: 23.19.231.78:3306
- æ•°æ®åº“: textdiff (utf8mb4_unicode_ci)
- æ—¶åŒº: +8:00
- è¡¨æ•°é‡: 13
- ç´¢å¼•å’Œå¤–é”®: å·²é…ç½®

#### ğŸ”œ ä¸‹ä¸€æ­¥è®¡åˆ’

1. å®Œæˆç”¨æˆ·è®¤è¯åç«¯å®ç°
2. æµ‹è¯•ç”¨æˆ·æ³¨å†Œå’Œç™»å½•åŠŸèƒ½
3. å®ç°å‰ç«¯è®¤è¯ç•Œé¢
4. é›†æˆæµ‹è¯•æ•´ä¸ªè®¤è¯æµç¨‹

**5. å¤šæ–‡æ¡£ç®¡ç†ç³»ç»Ÿ - åç«¯ (è¿›è¡Œä¸­)**

æ•°æ®æ¨¡å‹æ›´æ–°:
- æ›´æ–° `backend/app/models/document.py`
  - Documentæ·»åŠ owner_idå’Œfolder_idå­—æ®µ
  - Documentæ·»åŠ ownerå’Œfolderå…³ç³»
  - Versionæ·»åŠ author_idå­—æ®µ
  - Versionæ·»åŠ author_userå…³ç³»

ä¸šåŠ¡é€»è¾‘æ›´æ–°:
- æ›´æ–° `backend/app/services/version_service.py`
  - create_document()æ·»åŠ owner_idå‚æ•°
  - create_version()æ·»åŠ author_idå‚æ•°
  - æ–°å¢get_user_documents()æ–¹æ³•-è·å–ç”¨æˆ·æ–‡æ¡£åˆ—è¡¨
  - æ”¯æŒæŒ‰æ–‡ä»¶å¤¹ç­›é€‰

APIæ›´æ–°:
- æ›´æ–° `backend/app/api/routes/documents.py`
  - æ‰€æœ‰ç«¯ç‚¹æ·»åŠ ç”¨æˆ·è®¤è¯(get_current_active_user)
  - create_document()è‡ªåŠ¨è®¾ç½®owner_id
  - get_documents()æ”¹ä¸ºè·å–å½“å‰ç”¨æˆ·æ–‡æ¡£
  - æ‰€æœ‰æ–‡æ¡£æ“ä½œæ·»åŠ æƒé™æ£€æŸ¥(owneréªŒè¯)
  - create_version()æ·»åŠ author_idæ”¯æŒ
  - æ”¯æŒfolder_idå‚æ•°ç­›é€‰

æƒé™æ§åˆ¶:
- âœ… ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ–‡æ¡£
- âœ… ç”¨æˆ·åªèƒ½ä¿®æ”¹/åˆ é™¤è‡ªå·±çš„æ–‡æ¡£
- âœ… ç‰ˆæœ¬è‡ªåŠ¨å…³è”ä½œè€…ID
- âœ… 403 Forbiddené”™è¯¯å¤„ç†

**6. å¤šæ–‡æ¡£ç®¡ç†ç³»ç»Ÿ - å‰ç«¯ (âœ… å·²å®Œæˆ)**

é¡µé¢ç»„ä»¶:
- åˆ›å»º `frontend/src/views/DocumentListView.vue` - æ–‡æ¡£åˆ—è¡¨é¡µé¢
  - ç½‘æ ¼å¸ƒå±€å±•ç¤ºæ–‡æ¡£å¡ç‰‡
  - æ–‡æ¡£æ ‡é¢˜ã€ç‰ˆæœ¬å·ã€æ›´æ–°æ—¶é—´æ˜¾ç¤º
  - æœç´¢æ¡†å®æ—¶æœç´¢(300msé˜²æŠ–)
  - æ’åºé€‰é¡¹:æœ€è¿‘æ›´æ–°/åˆ›å»ºæ—¶é—´/æ ‡é¢˜
  - åˆ›å»ºæ–°æ–‡æ¡£æŒ‰é’®
  - å³é”®èœå•:é‡å‘½å/åˆ é™¤
  - åˆ†é¡µæ§åˆ¶
  - ç©ºçŠ¶æ€æç¤º
  - åŠ è½½çŠ¶æ€spinner

å¯¼èˆªç»„ä»¶:
- åˆ›å»º `frontend/src/components/Navbar.vue` - å¯¼èˆªæ ç»„ä»¶
  - å“ç‰ŒLogoå’Œæ ‡é¢˜
  - å¯¼èˆªé“¾æ¥(æˆ‘çš„æ–‡æ¡£)
  - ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º(å¤´åƒã€ç”¨æˆ·å)
  - ç”¨æˆ·ä¸‹æ‹‰èœå•:
    - ä¸ªäººèµ„æ–™
    - è®¾ç½®
    - é€€å‡ºç™»å½•
  - å“åº”å¼è®¾è®¡
  - ç¾è§‚çš„æ¸å˜UIè®¾è®¡

åº”ç”¨é›†æˆ:
- æ›´æ–° `frontend/src/App.vue`
  - é›†æˆNavbarç»„ä»¶
  - æ ¹æ®è·¯ç”±æ˜¾ç¤º/éšè—å¯¼èˆªæ 
  - åœ¨ç™»å½•/æ³¨å†Œé¡µä¸æ˜¾ç¤ºå¯¼èˆªæ 
  - ç»Ÿä¸€çš„åº”ç”¨å¸ƒå±€ç»“æ„

è·¯ç”±æ›´æ–°:
- æ›´æ–° `frontend/src/router/index.ts`
  - é¦–é¡µè·¯ç”±æŒ‡å‘DocumentListView
  - æ·»åŠ /documentsè·¯ç”±
  - ä¿ç•™/document/:idè¯¦æƒ…é¡µè·¯ç”±
  - æ‰€æœ‰è·¯ç”±éƒ½éœ€è¦è®¤è¯

åŠŸèƒ½æµ‹è¯•:
- âœ… æ–‡æ¡£åˆ—è¡¨åŠ è½½æ˜¾ç¤º
- âœ… åˆ›å»ºæ–°æ–‡æ¡£
- âœ… æ–‡æ¡£é‡å‘½å
- âœ… æ–‡æ¡£åˆ é™¤
- âœ… æœç´¢æ–‡æ¡£
- âœ… æ’åºåˆ‡æ¢
- âœ… åˆ†é¡µåŠŸèƒ½
- âœ… å¯¼èˆªæ æ˜¾ç¤º
- âœ… ç”¨æˆ·èœå•äº¤äº’

